"use strict";!function(e){window.wpdef_metabox={init:function(){e(".block-editor__container").length&&window.tagBox&&window.tagBox.init(),wpdef_metabox.post_count=wpdef.post_count,wpdef_metabox.existing_definitions=wpdef.existing_definitions,wpdef_metabox.animation_time=-40,wpdef_metabox.animation_time_begin=-20,wpdef_metabox.animation_time_end=20,wpdef_metabox.definition_count_current=0,wpdef_metabox.definition_count_new=0,wpdef_metabox.step=0,wpdef_metabox.performance_level=1,wpdef_metabox.typingTimer,wpdef_metabox.doneTypingInterval=800,wpdef_metabox.ajaxCallActive=!1,wpdef_metabox.add_performance_notice(),wpdef_metabox.performance_notice_ajax(),wpdef_metabox.set_enable_checkbox_state(),wpdef_metabox.set_add_tag_state(),wpdef_metabox.conditionally_show_use_image(),e(document).on("keyup",'input[name="newtag[definitions_title]"]',function(e){clearTimeout(wpdef_metabox.typingTimer),wpdef_metabox.typingTimer=setTimeout(wpdef_metabox.afterFinishedTyping,wpdef_metabox.doneTypingInterval)}),e(document).on("keydown",'input[name="newtag[definitions_title]"]',function(e){clearTimeout(wpdef_metabox.typingTimer)}),e(document).on("click",'input[name="dfn-definition-add"]',wpdef_metabox.performance_notice_ajax),e(document).on("click",'span[class="remove-tag-icon"]',wpdef_metabox.performance_notice_ajax),e(document).on("click",'input[name="dfn-definition-add"]',wpdef_metabox.add_definition_to_all_list),e(document).on("click",'span[class="remove-tag-icon"]',wpdef_metabox.remove_definition_from_all_list),e(document).on("click",'input[name="dfn-definition-add"]',wpdef_metabox.set_add_definition_state),e(document).on("click",'span[class="remove-tag-icon"]',wpdef_metabox.set_add_definition_state),e(document).on("change",'select[name="dfn-link-type"]',wpdef_metabox.conditionally_show_use_image)},set_add_definition_state:function(){wpdef_metabox.set_add_tag_state();var n=e('input[name="newtag[definitions_title]"]').val();if(0!=n.length){var t=n.split(","),i=wpdef_metabox.get_existing_definitions_from_list(t);if(i.length>0){if(i.length>1){i=i.join(", ");var o=wpdef_metabox.localize_string("already-in-use-plural").replace("{definitions}",i)}else o=wpdef_metabox.localize_string("already-in-use-single").replace("{definitions}",i);var a='<div class="dfn-icon-bullet-red"></div><span class="dfn-comment">'+o+"</span>";e(".dfn-definition-add-notice").html(a),e('input[name="dfn-definition-add"]').prop("disabled",!0)}else{if(n.indexOf(",")>=0)o=wpdef_metabox.localize_string("not-in-use-plural").replace("{definitions}",n);else o=wpdef_metabox.localize_string("not-in-use-single").replace("{definitions}",n);a='<div class="dfn-icon-bullet-green"></div><span class="dfn-comment">'+o+"</span>";e(".dfn-definition-add-notice").html(a),e('input[name="dfn-definition-add"]').prop("disabled",!1)}}},get_existing_definitions_from_list:function(n){var t=[];for(let o=0;o<n.length;o++){var i=e.trim(n[o]);-1!==e.inArray(i,wpdef_metabox.existing_definitions)&&t.push(i)}return t},afterFinishedTyping:function(e){wpdef_metabox.performance_notice_ajax(),wpdef_metabox.set_add_definition_state()},showSaveChanges:function(){e(".dfn-save-changes").show()},set_enable_checkbox_state:function(){0==wpdef_metabox.get_post_definitions_list().length?e('input[class="dfn-link-type"]').prop("disabled",!0):e('input[class="dfn-link-type"]').prop("disabled",!1)},set_add_tag_state:function(){if(wpdef_metabox.get_post_definitions_list(!0).length>0)e(".dfn-definition-add-notice").hide(),e('input[name="dfn-definition-add"]').closest(".ajaxtag").hide();else{var n='<div class="dfn-icon-bullet-red"></div><span class="dfn-comment">'+wpdef_metabox.localize_string("add-term")+"</span>";e(".dfn-definition-add-notice").html(n).show(),e('input[name="dfn-definition-add"]').closest(".ajaxtag").show()}},get_post_definitions_list:function(n){var t=[];if(!(n=void 0!==n&&n)){var i=e('input[name="newtag[definitions_title]"]').val();if(i.length)for(var o in i=i.split(","))i.hasOwnProperty(o)&&t.push(i[o])}return e(".dfn-post-definition-list li").each(function(){t.push(e(this).html().split("&nbsp;").pop())}),t},localize_string:function(e){return wpdef.strings.hasOwnProperty(e)?wpdef.strings[e]:""},add_definition_to_all_list:function(){var e=wpdef_metabox.get_post_definitions_list().pop();wpdef_metabox.existing_definitions.push(e),wpdef_metabox.set_enable_checkbox_state()},remove_definition_from_all_list:function(){var n=e(this).next().html().split(" ").pop();wpdef_metabox.existing_definitions=wpdef_metabox.existing_definitions.filter(function(e){return e!=n}),wpdef_metabox.set_enable_checkbox_state()},performance_notice_ajax:function(){var n=wpdef_metabox.get_post_definitions_list();wpdef_metabox.ajaxCallActive||(wpdef_metabox.ajaxCallActive=!0,e.ajax({type:"GET",url:wpdef.url,dataType:"json",data:{action:"wpdef_scan_definition_count",definitions:n,post_id:e("#post_ID").val()},success:function(e){wpdef_metabox.ajaxCallActive=!1,e.success&&(wpdef_metabox.definition_count_new=e.count,wpdef_metabox.start_animation())}}))},start_animation:function(){wpdef_metabox.definition_count_current!=wpdef_metabox.definition_count_new&&(wpdef_metabox.animation_time=wpdef_metabox.animation_time_begin,wpdef_metabox.step=(wpdef_metabox.definition_count_new-wpdef_metabox.definition_count_current)/40,wpdef_metabox.animate_performance_notice())},anitation_time_to_wait:function(e){return.1*e*e+e+1},animate_performance_notice:function(){var n=wpdef_metabox.calculate_performance_level(Math.round(wpdef_metabox.definition_count_current),wpdef_metabox.post_count);wpdef_metabox.animation_time!=wpdef_metabox.animation_time_end?(wpdef_metabox.animation_time++,wpdef_metabox.definition_count_current=Number(wpdef_metabox.definition_count_current)+Number(wpdef_metabox.step),wpdef_metabox.performance_level!=n?(wpdef_metabox.performance_level=n,wpdef_metabox.add_performance_notice(),setTimeout(wpdef_metabox.animate_performance_notice,wpdef_metabox.anitation_time_to_wait(wpdef_metabox.animation_time))):(e(".dfn-definition-count").html(Math.round(wpdef_metabox.definition_count_current)),setTimeout(wpdef_metabox.animate_performance_notice,wpdef_metabox.anitation_time_to_wait(wpdef_metabox.animation_time)))):wpdef_metabox.performance_level!=wpdef_metabox.calculate_performance_level(Math.round(wpdef_metabox.definition_count_current),wpdef_metabox.post_count)?(wpdef_metabox.performance_level=n,wpdef_metabox.definition_count_current=wpdef_metabox.definition_count_new,wpdef_metabox.add_performance_notice()):(e(".dfn-definition-count").val(wpdef_metabox.definition_count_new),wpdef_metabox.definition_count_current=wpdef_metabox.definition_count_new)},add_performance_notice:function(){var n=wpdef_metabox.get_post_definitions_list();console.log("add performance notice "+n.length),n.length>0?e(".dfn-show-if-term ").removeClass("dfn-disabled"):e(".dfn-show-if-term ").addClass("dfn-disabled");var t=wpdef_metabox.get_performance_notice_html(wpdef_metabox.definition_count_current);e(".dfn-performance-notice").html(t)},get_performance_notice_html:function(e){e=Math.round(e);var n="",t="<span class='dfn-definition-count-notice'>"+wpdef_metabox.localize_string("terms-in-posts")+"<span>";t=(t=t.replace("{terms_count}","<span class='dfn-definition-count'>"+e+"</span>")).replace("{posts_count}",""+wpdef_metabox.post_count);var i="";4==wpdef_metabox.performance_level&&(n="<div class='dfn-icon-bullet-red'></div>",i="<span class='dfn-comment'>"+wpdef_metabox.localize_string("way-too-many-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>"),3==wpdef_metabox.performance_level&&(n="<div class='dfn-icon-bullet-orange'></div>",i="<span class='dfn-comment'>"+wpdef_metabox.localize_string("too-many-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>"),2==wpdef_metabox.performance_level&&(n="<div class='dfn-icon-bullet-orange'></div>",i="<span class='dfn-comment'>"+wpdef_metabox.localize_string("few-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>"),1==wpdef_metabox.performance_level&&(n="<div class='dfn-icon-bullet-green'></div>",i="<span class='dfn-comment'>"+wpdef_metabox.localize_string("positive-ratio-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>"),0==wpdef_metabox.performance_level&&(n="<div class='dfn-icon-bullet-red'></div>",i="<span class='dfn-comment'>"+wpdef_metabox.localize_string("no-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>");var o="";return o+="<div class='dfn-field'>",o+=n,o+=t,o+="</div>",o+=i,o+="<input type='hidden' class='dfn-definition-ids' value='"+e+"'>",o+="<br><br>"},calculate_performance_level:function(e,n){return 0==e?0:e<5?2:e>500&&e/n>.5?4:e>100&&e/n>.25?3:1},conditionally_show_use_image:function(){"hyperlink"!==e('select[name="dfn-link-type"]').val()?e(".dfn-disable-image").closest(".dfn-field").show():e(".dfn-disable-image").closest(".dfn-field").hide()}}}(jQuery),jQuery(document).ready(function(e){window.wpdef_metabox.init()});