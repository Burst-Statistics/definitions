"use strict";(function(a){window.wpdef_metabox={init:function(){if(a(".block-editor__container").length){window.tagBox&&window.tagBox.init()}wpdef_metabox.post_count=wpdef.post_count;wpdef_metabox.existing_definitions=wpdef.existing_definitions;wpdef_metabox.animation_time=-40;wpdef_metabox.animation_time_begin=-20;wpdef_metabox.animation_time_end=20;wpdef_metabox.definition_count_current=0;wpdef_metabox.definition_count_new=0;wpdef_metabox.step=0;wpdef_metabox.performance_level=0;wpdef_metabox.typingTimer;wpdef_metabox.doneTypingInterval=800;wpdef_metabox.last_checked_definition;wpdef_metabox.ajaxCallActive=false;wpdef_metabox.add_performance_notice();wpdef_metabox.performance_notice_ajax();wpdef_metabox.set_enable_checkbox_state();wpdef_metabox.set_add_tag_state();wpdef_metabox.conditionally_show_use_image();a(document).on("keyup",'#definitions_box_id input[name="newtag[definitions_title]"]',function(b){clearTimeout(wpdef_metabox.typingTimer);wpdef_metabox.typingTimer=setTimeout(wpdef_metabox.afterFinishedTyping,wpdef_metabox.doneTypingInterval)});a(document).on("keydown",'#definitions_box_id input[name="newtag[definitions_title]"]',function(b){clearTimeout(wpdef_metabox.typingTimer)});a(document).on("click",'#definitions_box_id input[name="dfn-definition-add"]',wpdef_metabox.handle_add_tag);a(document).on("click",".remove-tag-icon",wpdef_metabox.handle_remove_tag);a(document).on("change",'#definitions_box_id select[name="dfn-link-type"]',wpdef_metabox.conditionally_show_use_image)},handle_remove_tag:function(){wpdef_metabox.set_add_tag_state();wpdef_metabox.remove_definition_from_all_list(a(this));wpdef_metabox.set_add_definition_state();wpdef_metabox.performance_notice_ajax();wpdef_metabox.set_enable_checkbox_state()},handle_add_tag:function(){wpdef_metabox.add_definition_to_all_list();wpdef_metabox.performance_notice_ajax();wpdef_metabox.set_add_tag_state();wpdef_metabox.set_add_definition_state();wpdef_metabox.set_enable_checkbox_state()},afterFinishedTyping:function(b){wpdef_metabox.performance_notice_ajax();wpdef_metabox.set_add_tag_state();wpdef_metabox.set_add_definition_state();wpdef_metabox.set_enable_checkbox_state()},set_add_definition_state:function(){var f=a('#definitions_box_id input[name="newtag[definitions_title]"]').val();if(f.length==0){return}var c=f.split(",");var e=wpdef_metabox.get_existing_definitions_from_list(c);if(e.length>0){if(e.length>1){e=e.join(", ");var d=wpdef_metabox.localize_string("already-in-use-plural").replace("{definitions}",e)}else{var d=wpdef_metabox.localize_string("already-in-use-single").replace("{definitions}",e)}var b='<div class="dfn-icon-bullet dfn-icon-bullet-red"></div><span class="dfn-comment">'+d+"</span>";a("#definitions_box_id .dfn-definition-add-notice").html(b);a('#definitions_box_id input[name="dfn-definition-add"]').prop("disabled",true)}else{if(f.indexOf(",")>=0){var d=wpdef_metabox.localize_string("not-in-use-plural").replace("{definitions}",f)}else{var d=wpdef_metabox.localize_string("not-in-use-single").replace("{definitions}",f)}var b='<div class="dfn-icon-bullet dfn-icon-bullet-green"></div><span class="dfn-comment">'+d+"</span>";a("#definitions_box_id .dfn-definition-add-notice").html(b);a('#definitions_box_id input[name="dfn-definition-add"]').prop("disabled",false)}},get_existing_definitions_from_list:function(b){var d=[];for(let i=0;i<b.length;i++){var c=a.trim(b[i]);if(a.inArray(c,wpdef_metabox.existing_definitions)!==-1){d.push(c)}}return d},showSaveChanges:function(){a("#definitions_box_id .dfn-save-changes").show()},set_enable_checkbox_state:function(){var b=wpdef_metabox.get_post_definitions_list(false);if(b.length>0){a("#definitions_box_id .dfn-show-if-term ").removeClass("dfn-disabled");a("#definitions_box_id input.dfn-link-type").prop("disabled",false)}else{a("#definitions_box_id .dfn-show-if-term ").addClass("dfn-disabled");a("#definitions_box_id input.dfn-link-type").prop("disabled",true)}},set_add_tag_state:function(){var b=wpdef_metabox.get_post_definitions_list(true);if(b.length>0){a("#definitions_box_id .dfn-definition-add-notice").hide();a('#definitions_box_id input[name="dfn-definition-add"]').closest(".ajaxtag").hide()}else{var c='<div class="dfn-icon-bullet dfn-icon-bullet-red"></div><span class="dfn-comment">'+wpdef_metabox.localize_string("add-term")+"</span>";a("#definitions_box_id .dfn-definition-add-notice").html(c).show();a('#definitions_box_id input[name="dfn-definition-add"]').closest(".ajaxtag").show()}},get_post_definitions_list:function(c){c=(typeof(c)!=="undefined")?c:false;var e=[];if(!c){var d=a('#definitions_box_id input[name="newtag[definitions_title]"]').val();if(d.length){d=d.split(",");for(var b in d){if(d.hasOwnProperty(b)){e.push(d[b])}}}}a("#definitions_box_id .dfn-post-definition-list li").each(function(){e.push(a(this).html().split("&nbsp;").pop())});return e},localize_string:function(b){if(wpdef.strings.hasOwnProperty(b)){return wpdef.strings[b]}return""},add_definition_to_all_list:function(){var b=wpdef_metabox.get_post_definitions_list().pop();wpdef_metabox.existing_definitions.push(b)},remove_definition_from_all_list:function(c){var b=c.next().html().split(" ").pop();wpdef_metabox.existing_definitions=wpdef_metabox.existing_definitions.filter(function(d){return d!=b})},performance_notice_ajax:function(){var b=wpdef_metabox.get_post_definitions_list();if(b.length==0){return}if(wpdef_metabox.last_checked_definition===b[0]){return}if(wpdef_metabox.ajaxCallActive){return}a(".dfn-performance-notice").html(wpdef_metabox.localize_string("retrieving-status"));wpdef_metabox.performance_level=-1;wpdef_metabox.ajaxCallActive=true;a.ajax({type:"GET",url:wpdef.url,dataType:"json",data:({action:"wpdef_scan_definition_count",definitions:b,post_id:a("#post_ID").val()}),success:function(c){wpdef_metabox.last_checked_definition=b[0];wpdef_metabox.ajaxCallActive=false;if(c.success){wpdef_metabox.definition_count_new=c.count;wpdef_metabox.start_animation()}},error:function(c){console.log("error retrieving count");wpdef_metabox.ajaxCallActive=false}})},start_animation:function(){if(wpdef_metabox.definition_count_current==wpdef_metabox.definition_count_new){wpdef_metabox.animation_time=wpdef_metabox.animation_time_end}else{wpdef_metabox.animation_time=wpdef_metabox.animation_time_begin;wpdef_metabox.step=(wpdef_metabox.definition_count_new-wpdef_metabox.definition_count_current)/40}wpdef_metabox.animate_performance_notice()},anitation_time_to_wait:function(b){return 0.1*b*b+b+1},animate_performance_notice:function(){var b=wpdef_metabox.calculate_performance_level(Math.round(wpdef_metabox.definition_count_current),wpdef_metabox.post_count);if(wpdef_metabox.animation_time!=wpdef_metabox.animation_time_end){wpdef_metabox.animation_time++;wpdef_metabox.definition_count_current=Number(wpdef_metabox.definition_count_current)+Number(wpdef_metabox.step);if(wpdef_metabox.performance_level!=b){wpdef_metabox.performance_level=b;wpdef_metabox.add_performance_notice();setTimeout(wpdef_metabox.animate_performance_notice,wpdef_metabox.anitation_time_to_wait(wpdef_metabox.animation_time))}else{a("#definitions_box_id .dfn-definition-count").html(Math.round(wpdef_metabox.definition_count_current));setTimeout(wpdef_metabox.animate_performance_notice,wpdef_metabox.anitation_time_to_wait(wpdef_metabox.animation_time))}}else{if(wpdef_metabox.performance_level!=b){wpdef_metabox.performance_level=b;wpdef_metabox.definition_count_current=wpdef_metabox.definition_count_new;wpdef_metabox.add_performance_notice()}else{a("#definitions_box_id .dfn-definition-count").val(wpdef_metabox.definition_count_new);wpdef_metabox.definition_count_current=wpdef_metabox.definition_count_new}}},add_performance_notice:function(){var c=wpdef_metabox.get_post_definitions_list();if(c.length>0){a("#definitions_box_id .dfn-show-if-term ").removeClass("dfn-disabled")}else{a("#definitions_box_id .dfn-show-if-term ").addClass("dfn-disabled")}var b=wpdef_metabox.get_performance_notice_html(wpdef_metabox.definition_count_current);a("#definitions_box_id .dfn-performance-notice").html(b)},get_performance_notice_html:function(b){b=Math.round(b);var e="";var f="<span class='dfn-definition-count-notice'>"+wpdef_metabox.localize_string("terms-in-posts")+"<span>";f=f.replace("{terms_count}","<span class='dfn-definition-count'>"+b+"</span>");f=f.replace("{posts_count}",""+wpdef_metabox.post_count);var d="";if(wpdef_metabox.performance_level==4){e="<div class='dfn-icon-bullet dfn-icon-bullet-red'></div>";d="<span class='dfn-comment'>"+wpdef_metabox.localize_string("way-too-many-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>"}if(wpdef_metabox.performance_level==3){e="<div class='dfn-icon-bullet dfn-icon-bullet-orange'></div>";d="<span class='dfn-comment'>"+wpdef_metabox.localize_string("too-many-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>"}if(wpdef_metabox.performance_level==2){e="<div class='dfn-icon-bullet dfn-icon-bullet-orange'></div>";d="<span class='dfn-comment'>"+wpdef_metabox.localize_string("few-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>"}if(wpdef_metabox.performance_level==1){e="<div class='dfn-icon-bullet dfn-icon-bullet-green'></div>";d="<span class='dfn-comment'>"+wpdef_metabox.localize_string("positive-ratio-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>"}if(wpdef_metabox.performance_level==0){e="<div class='dfn-icon-bullet dfn-icon-bullet-red'></div>";d="<span class='dfn-comment'>"+wpdef_metabox.localize_string("no-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>"}var c="";c+="<div class='dfn-field'>";c+=e;c+=f;c+="</div>";c+=d;c+="<input type='hidden' class='dfn-definition-ids' value='"+b+"'>";c+="<br><br>";return c},calculate_performance_level:function(b,c){if((b==0)){return 0}if((b<5)){return 2}if((b>500)&&(b/c>0.5)){return 4}if((b>100)&&(b/c>0.25)){return 3}return 1},conditionally_show_use_image:function(){if(a('#definitions_box_id select[name="dfn-link-type"]').val()!=="hyperlink"){a(".dfn-disable-image").closest(".dfn-field").show()}else{a(".dfn-disable-image").closest(".dfn-field").hide()}}}}(jQuery));jQuery(document).ready(function(a){window.wpdef_metabox.init()});