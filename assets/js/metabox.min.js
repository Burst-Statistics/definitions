"use strict";!function(o){window.wpdef_metabox={init:function(){o(".block-editor__container").length&&window.tagBox&&window.tagBox.init(),wpdef_metabox.post_count=wpdef.post_count,wpdef_metabox.existing_definitions=wpdef.existing_definitions,wpdef_metabox.animation_time=-40,wpdef_metabox.animation_time_begin=-20,wpdef_metabox.animation_time_end=20,wpdef_metabox.definition_count_current=0,wpdef_metabox.definition_count_new=0,wpdef_metabox.step=0,wpdef_metabox.performance_level=1,wpdef_metabox.typingTimer,wpdef_metabox.doneTypingInterval=800,wpdef_metabox.ajaxCallActive=!1,wpdef_metabox.add_performance_notice(),wpdef_metabox.performance_notice_ajax(),wpdef_metabox.set_enable_checkbox_state(),wpdef_metabox.set_add_tag_state(),wpdef_metabox.conditionally_show_use_image(),o(document).on("keyup",'input[name="newtag[definitions_title]"]',function(e){clearTimeout(wpdef_metabox.typingTimer),wpdef_metabox.typingTimer=setTimeout(wpdef_metabox.afterFinishedTyping,wpdef_metabox.doneTypingInterval)}),o(document).on("keydown",'input[name="newtag[definitions_title]"]',function(e){clearTimeout(wpdef_metabox.typingTimer)}),o(document).on("click",'input[name="dfn-definition-add"]',wpdef_metabox.performance_notice_ajax),o(document).on("click",'span[class="remove-tag-icon"]',wpdef_metabox.performance_notice_ajax),o(document).on("click",'input[name="dfn-definition-add"]',wpdef_metabox.add_definition_to_all_list),o(document).on("click",'span[class="remove-tag-icon"]',wpdef_metabox.remove_definition_from_all_list),o(document).on("click",'input[name="dfn-definition-add"]',wpdef_metabox.set_add_definition_state),o(document).on("click",'span[class="remove-tag-icon"]',wpdef_metabox.set_add_definition_state),o(document).on("change",'select[name="dfn-link-type"]',wpdef_metabox.conditionally_show_use_image)},set_add_definition_state:function(){wpdef_metabox.set_add_tag_state();var e,n,t=o('input[name="newtag[definitions_title]"]').val();0!=t.length&&(e=t.split(","),0<(e=wpdef_metabox.get_existing_definitions_from_list(e)).length?(n='<div class="dfn-icon-bullet-red"></div><span class="dfn-comment">'+(1<e.length?(e=e.join(", "),wpdef_metabox.localize_string("already-in-use-plural").replace("{definitions}",e)):wpdef_metabox.localize_string("already-in-use-single").replace("{definitions}",e))+"</span>",o(".dfn-definition-add-notice").html(n),o('input[name="dfn-definition-add"]').prop("disabled",!0)):(n='<div class="dfn-icon-bullet-green"></div><span class="dfn-comment">'+(0<=t.indexOf(",")?wpdef_metabox.localize_string("not-in-use-plural"):wpdef_metabox.localize_string("not-in-use-single")).replace("{definitions}",t)+"</span>",o(".dfn-definition-add-notice").html(n),o('input[name="dfn-definition-add"]').prop("disabled",!1)))},get_existing_definitions_from_list:function(n){var t=[];for(let e=0;e<n.length;e++){var i=o.trim(n[e]);-1!==o.inArray(i,wpdef_metabox.existing_definitions)&&t.push(i)}return t},afterFinishedTyping:function(e){wpdef_metabox.performance_notice_ajax(),wpdef_metabox.set_add_definition_state()},showSaveChanges:function(){o(".dfn-save-changes").show()},set_enable_checkbox_state:function(){0==wpdef_metabox.get_post_definitions_list().length?o('input[class="dfn-disable"]').prop("disabled",!0):o('input[class="dfn-disable"]').prop("disabled",!1)},set_add_tag_state:function(){var e;0<wpdef_metabox.get_post_definitions_list(!0).length?(o(".dfn-definition-add-notice").hide(),o('input[name="dfn-definition-add"]').closest(".ajaxtag").hide()):(e='<div class="dfn-icon-bullet-red"></div><span class="dfn-comment">'+wpdef_metabox.localize_string("add-term")+"</span>",o(".dfn-definition-add-notice").html(e).show(),o('input[name="dfn-definition-add"]').closest(".ajaxtag").show())},get_post_definitions_list:function(e){var n=[];if(!(e=void 0!==e&&e)){var t=o('input[name="newtag[definitions_title]"]').val();if(t.length)for(var i in t=t.split(","))t.hasOwnProperty(i)&&n.push(t[i])}return o(".dfn-post-definition-list li").each(function(){n.push(o(this).html().split("&nbsp;").pop())}),n},localize_string:function(e){return wpdef.strings.hasOwnProperty(e)?wpdef.strings[e]:""},add_definition_to_all_list:function(){var e=wpdef_metabox.get_post_definitions_list().pop();wpdef_metabox.existing_definitions.push(e),wpdef_metabox.set_enable_checkbox_state()},remove_definition_from_all_list:function(){var n=o(this).next().html().split(" ").pop();wpdef_metabox.existing_definitions=wpdef_metabox.existing_definitions.filter(function(e){return e!=n}),wpdef_metabox.set_enable_checkbox_state()},performance_notice_ajax:function(){var e=wpdef_metabox.get_post_definitions_list();wpdef_metabox.ajaxCallActive||(wpdef_metabox.ajaxCallActive=!0,o.ajax({type:"GET",url:wpdef.url,dataType:"json",data:{action:"wpdef_scan_definition_count",definitions:e,post_id:o("#post_ID").val()},success:function(e){wpdef_metabox.ajaxCallActive=!1,e.success&&(console.log("counted uses"),console.log(e.count),wpdef_metabox.definition_count_new=e.count,wpdef_metabox.start_animation())}}))},start_animation:function(){wpdef_metabox.definition_count_current!=wpdef_metabox.definition_count_new&&(wpdef_metabox.animation_time=wpdef_metabox.animation_time_begin,wpdef_metabox.step=(wpdef_metabox.definition_count_new-wpdef_metabox.definition_count_current)/40,wpdef_metabox.animate_performance_notice())},anitation_time_to_wait:function(e){return.1*e*e+e+1},animate_performance_notice:function(){var e=wpdef_metabox.calculate_performance_level(Math.round(wpdef_metabox.definition_count_current),wpdef_metabox.post_count);wpdef_metabox.animation_time!=wpdef_metabox.animation_time_end?(wpdef_metabox.animation_time++,wpdef_metabox.definition_count_current=Number(wpdef_metabox.definition_count_current)+Number(wpdef_metabox.step),wpdef_metabox.performance_level!=e?(wpdef_metabox.performance_level=e,wpdef_metabox.add_performance_notice()):o(".dfn-definition-count").html(Math.round(wpdef_metabox.definition_count_current)),setTimeout(wpdef_metabox.animate_performance_notice,wpdef_metabox.anitation_time_to_wait(wpdef_metabox.animation_time))):wpdef_metabox.performance_level!=wpdef_metabox.calculate_performance_level(Math.round(wpdef_metabox.definition_count_current),wpdef_metabox.post_count)?(wpdef_metabox.performance_level=e,wpdef_metabox.definition_count_current=wpdef_metabox.definition_count_new,wpdef_metabox.add_performance_notice()):(o(".dfn-definition-count").val(wpdef_metabox.definition_count_new),wpdef_metabox.definition_count_current=wpdef_metabox.definition_count_new)},add_performance_notice:function(){var e=wpdef_metabox.get_performance_notice_html(wpdef_metabox.definition_count_current);o(".dfn-performance-notice").html(e)},get_performance_notice_html:function(e){e=Math.round(e);var n="",t="<span class='dfn-definition-count-notice'>"+wpdef_metabox.localize_string("terms-in-posts")+"<span>";t=(t=t.replace("{terms_count}","<span class='dfn-definition-count'>"+e+"</span>")).replace("{posts_count}",""+wpdef_metabox.post_count);var i="";3==wpdef_metabox.performance_level&&(n="<div class='dfn-icon-bullet-red'></div>",i="<span class='dfn-comment'>"+wpdef_metabox.localize_string("way-too-many-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>"),2==wpdef_metabox.performance_level&&(n="<div class='dfn-icon-bullet-orange'></div>",i="<span class='dfn-comment'>"+wpdef_metabox.localize_string("too-many-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>"),1==wpdef_metabox.performance_level&&(n="<div class='dfn-icon-bullet-green'></div>",i="<span class='dfn-comment'>"+wpdef_metabox.localize_string("positive-ratio-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>");var o="";return o+="<div class='dfn-field'>",o+=n,o+=t,o+="</div>",o+=i,o+="<input type='hidden' class='dfn-definition-ids' value='"+e+"'>",o+="<br><br>"},calculate_performance_level:function(e,n){return 500<e&&.5<e/n?3:100<e&&.25<e/n?2:1},conditionally_show_use_image:function(){"hyperlink"!==o('select[name="dfn-link-type"]').val()?o(".dfn-disable-image").closest(".dfn-field").show():o(".dfn-disable-image").closest(".dfn-field").hide()}}}(jQuery),jQuery(document).ready(function(e){window.wpdef_metabox.init()});