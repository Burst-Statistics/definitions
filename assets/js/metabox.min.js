"use strict";(function(a){window.rspdef_metabox={init:function(){if(a(".block-editor__container").length){window.tagBox&&window.tagBox.init()}rspdef_metabox.post_count=rspdef.post_count;rspdef_metabox.existing_definitions=rspdef.existing_definitions;rspdef_metabox.animation_time=-40;rspdef_metabox.animation_time_begin=-20;rspdef_metabox.animation_time_end=20;rspdef_metabox.definition_count_current=0;rspdef_metabox.definition_count_new=0;rspdef_metabox.step=0;rspdef_metabox.performance_level=0;rspdef_metabox.typingTimer;rspdef_metabox.doneTypingInterval=800;rspdef_metabox.last_checked_definition;rspdef_metabox.ajaxCallActive=false;rspdef_metabox.add_performance_notice();rspdef_metabox.performance_notice_ajax();rspdef_metabox.set_enable_checkbox_state();rspdef_metabox.set_add_tag_state();rspdef_metabox.conditionally_show_use_image();a(document).on("keyup",'#definitions_box_id input[name="newtag[definitions_title]"]',function(b){clearTimeout(rspdef_metabox.typingTimer);rspdef_metabox.typingTimer=setTimeout(rspdef_metabox.afterFinishedTyping,rspdef_metabox.doneTypingInterval)});a(document).on("keydown",'#definitions_box_id input[name="newtag[definitions_title]"]',function(b){clearTimeout(rspdef_metabox.typingTimer)});a(document).on("click",'#definitions_box_id input[name="rspdef-definition-add"]',rspdef_metabox.handle_add_tag);a(document).on("click",".remove-tag-icon",rspdef_metabox.handle_remove_tag);a(document).on("change",'#definitions_box_id select[name="rspdef-link-type"]',rspdef_metabox.conditionally_show_use_image)},handle_remove_tag:function(){rspdef_metabox.set_add_tag_state();rspdef_metabox.remove_definition_from_all_list(a(this));rspdef_metabox.set_add_definition_state();rspdef_metabox.performance_notice_ajax();rspdef_metabox.set_enable_checkbox_state()},handle_add_tag:function(){rspdef_metabox.add_definition_to_all_list();rspdef_metabox.performance_notice_ajax();rspdef_metabox.set_add_tag_state();rspdef_metabox.set_add_definition_state();rspdef_metabox.set_enable_checkbox_state()},afterFinishedTyping:function(b){rspdef_metabox.performance_notice_ajax();rspdef_metabox.set_add_tag_state();rspdef_metabox.set_add_definition_state();rspdef_metabox.set_enable_checkbox_state()},set_add_definition_state:function(){var f=a('#definitions_box_id input[name="newtag[definitions_title]"]').val();if(f.length==0){return}var c=f.split(",");var e=rspdef_metabox.get_existing_definitions_from_list(c);if(e.length>0){if(e.length>1){e=e.join(", ");var d=rspdef_metabox.localize_string("already-in-use-plural").replace("{definitions}",e)}else{var d=rspdef_metabox.localize_string("already-in-use-single").replace("{definitions}",e)}var b='<div class="rspdef-icon-bullet rspdef-icon-bullet-red"></div><span class="rspdef-comment">'+d+"</span>";a("#definitions_box_id .rspdef-definition-add-notice").html(b);a('#definitions_box_id input[name="rspdef-definition-add"]').prop("disabled",true)}else{if(f.indexOf(",")>=0){var d=rspdef_metabox.localize_string("not-in-use-plural").replace("{definitions}",f)}else{var d=rspdef_metabox.localize_string("not-in-use-single").replace("{definitions}",f)}var b='<div class="rspdef-icon-bullet rspdef-icon-bullet-green"></div><span class="rspdef-comment">'+d+"</span>";a("#definitions_box_id .rspdef-definition-add-notice").html(b);a('#definitions_box_id input[name="rspdef-definition-add"]').prop("disabled",false)}},get_existing_definitions_from_list:function(b){var d=[];for(let i=0;i<b.length;i++){var c=a.trim(b[i]);if(a.inArray(c,rspdef_metabox.existing_definitions)!==-1){d.push(c)}}return d},showSaveChanges:function(){a("#definitions_box_id .rspdef-save-changes").show()},set_enable_checkbox_state:function(){var b=rspdef_metabox.get_post_definitions_list(false);if(b.length>0){a("#definitions_box_id .rspdef-show-if-term ").removeClass("rspdef-disabled");a("#definitions_box_id input.rspdef-link-type").prop("disabled",false)}else{a("#definitions_box_id .rspdef-show-if-term ").addClass("rspdef-disabled");a("#definitions_box_id input.rspdef-link-type").prop("disabled",true)}},set_add_tag_state:function(){var b=rspdef_metabox.get_post_definitions_list(true);if(b.length>0){a("#definitions_box_id .rspdef-definition-add-notice").hide();a('#definitions_box_id input[name="rspdef-definition-add"]').closest(".ajaxtag").hide()}else{var c='<div class="rspdef-icon-bullet rspdef-icon-bullet-red"></div><span class="rspdef-comment">'+rspdef_metabox.localize_string("add-term")+"</span>";a("#definitions_box_id .rspdef-definition-add-notice").html(c).show();a('#definitions_box_id input[name="rspdef-definition-add"]').closest(".ajaxtag").show()}},get_post_definitions_list:function(c){c=(typeof(c)!=="undefined")?c:false;var e=[];if(!c){var d=a('#definitions_box_id input[name="newtag[definitions_title]"]').val();if(d.length){d=d.split(",");for(var b in d){if(d.hasOwnProperty(b)){e.push(d[b])}}}}a("#definitions_box_id .rspdef-post-definition-list li").each(function(){e.push(a(this).html().split("&nbsp;").pop())});return e},localize_string:function(b){if(rspdef.strings.hasOwnProperty(b)){return rspdef.strings[b]}return""},add_definition_to_all_list:function(){var b=rspdef_metabox.get_post_definitions_list().pop();rspdef_metabox.existing_definitions.push(b)},remove_definition_from_all_list:function(c){var b=c.next().html().split(" ").pop();rspdef_metabox.existing_definitions=rspdef_metabox.existing_definitions.filter(function(d){return d!=b})},performance_notice_ajax:function(){var b=rspdef_metabox.get_post_definitions_list();if(b.length==0){return}if(rspdef_metabox.last_checked_definition===b[0]){return}if(rspdef_metabox.ajaxCallActive){return}a(".rspdef-performance-notice").html(rspdef_metabox.localize_string("retrieving-status"));rspdef_metabox.performance_level=-1;rspdef_metabox.ajaxCallActive=true;a.ajax({type:"GET",url:rspdef.url,dataType:"json",data:({action:"rspdef_scan_definition_count",definitions:b,post_id:a("#post_ID").val()}),success:function(c){rspdef_metabox.last_checked_definition=b[0];rspdef_metabox.ajaxCallActive=false;if(c.success){rspdef_metabox.definition_count_new=c.count;rspdef_metabox.start_animation()}},error:function(c){console.log("error retrieving count");rspdef_metabox.ajaxCallActive=false}})},start_animation:function(){if(rspdef_metabox.definition_count_current==rspdef_metabox.definition_count_new){rspdef_metabox.animation_time=rspdef_metabox.animation_time_end}else{rspdef_metabox.animation_time=rspdef_metabox.animation_time_begin;rspdef_metabox.step=(rspdef_metabox.definition_count_new-rspdef_metabox.definition_count_current)/40}rspdef_metabox.animate_performance_notice()},anitation_time_to_wait:function(b){return 0.1*b*b+b+1},animate_performance_notice:function(){var b=rspdef_metabox.calculate_performance_level(Math.round(rspdef_metabox.definition_count_current),rspdef_metabox.post_count);if(rspdef_metabox.animation_time!=rspdef_metabox.animation_time_end){rspdef_metabox.animation_time++;rspdef_metabox.definition_count_current=Number(rspdef_metabox.definition_count_current)+Number(rspdef_metabox.step);if(rspdef_metabox.performance_level!=b){rspdef_metabox.performance_level=b;rspdef_metabox.add_performance_notice();setTimeout(rspdef_metabox.animate_performance_notice,rspdef_metabox.anitation_time_to_wait(rspdef_metabox.animation_time))}else{a("#definitions_box_id .rspdef-definition-count").html(Math.round(rspdef_metabox.definition_count_current));setTimeout(rspdef_metabox.animate_performance_notice,rspdef_metabox.anitation_time_to_wait(rspdef_metabox.animation_time))}}else{if(rspdef_metabox.performance_level!=b){rspdef_metabox.performance_level=b;rspdef_metabox.definition_count_current=rspdef_metabox.definition_count_new;rspdef_metabox.add_performance_notice()}else{a("#definitions_box_id .rspdef-definition-count").val(rspdef_metabox.definition_count_new);rspdef_metabox.definition_count_current=rspdef_metabox.definition_count_new}}},add_performance_notice:function(){var c=rspdef_metabox.get_post_definitions_list();if(c.length>0){a("#definitions_box_id .rspdef-show-if-term ").removeClass("rspdef-disabled")}else{a("#definitions_box_id .rspdef-show-if-term ").addClass("rspdef-disabled")}var b=rspdef_metabox.get_performance_notice_html(rspdef_metabox.definition_count_current);a("#definitions_box_id .rspdef-performance-notice").html(b)},get_performance_notice_html:function(b){b=Math.round(b);var e="";var f="<span class='rspdef-definition-count-notice'>"+rspdef_metabox.localize_string("terms-in-posts")+"<span>";f=f.replace("{terms_count}","<span class='rspdef-definition-count'>"+b+"</span>");f=f.replace("{posts_count}",""+rspdef_metabox.post_count);var d="";if(rspdef_metabox.performance_level==4){e="<div class='rspdef-icon-bullet rspdef-icon-bullet-red'></div>";d="<span class='rspdef-comment'>"+rspdef_metabox.localize_string("way-too-many-terms")+" <a href='https://really-simple-plugins.com/definitions-internal-linkbuilding/documentation'>"+rspdef_metabox.localize_string("read-more")+"</a><span>"}if(rspdef_metabox.performance_level==3){e="<div class='rspdef-icon-bullet rspdef-icon-bullet-orange'></div>";d="<span class='rspdef-comment'>"+rspdef_metabox.localize_string("too-many-terms")+" <a href='https://really-simple-plugins.com/definitions-internal-linkbuilding/documentation'>"+rspdef_metabox.localize_string("read-more")+"</a><span>"}if(rspdef_metabox.performance_level==2){e="<div class='rspdef-icon-bullet rspdef-icon-bullet-orange'></div>";d="<span class='rspdef-comment'>"+rspdef_metabox.localize_string("few-terms")+" <a href='https://really-simple-plugins.com/definitions-internal-linkbuilding/documentation'>"+rspdef_metabox.localize_string("read-more")+"</a><span>"}if(rspdef_metabox.performance_level==1){e="<div class='rspdef-icon-bullet rspdef-icon-bullet-green'></div>";d="<span class='rspdef-comment'>"+rspdef_metabox.localize_string("positive-ratio-terms")+" <a href='https://really-simple-plugins.com/definitions-internal-linkbuilding/documentation'>"+rspdef_metabox.localize_string("read-more")+"</a><span>"}if(rspdef_metabox.performance_level==0){e="<div class='rspdef-icon-bullet rspdef-icon-bullet-red'></div>";d="<span class='rspdef-comment'>"+rspdef_metabox.localize_string("no-terms")+" <a href='https://really-simple-plugins.com/definitions-internal-linkbuilding/documentation'>"+rspdef_metabox.localize_string("read-more")+"</a><span>"}var c="";c+="<div class='rspdef-field'>";c+=e;c+=f;c+="</div>";c+=d;c+="<input type='hidden' class='rspdef-definition-ids' value='"+b+"'>";c+="<br><br>";return c},calculate_performance_level:function(b,c){if((b==0)){return 0}if((b<5)){return 2}if((b>500)&&(b/c>0.5)){return 4}if((b>100)&&(b/c>0.25)){return 3}return 1},conditionally_show_use_image:function(){if(a('#definitions_box_id select[name="rspdef-link-type"]').val()!=="hyperlink"){a(".rspdef-disable-image").closest(".rspdef-field").show()}else{a(".rspdef-disable-image").closest(".rspdef-field").hide()}}}}(jQuery));jQuery(document).ready(function(a){window.rspdef_metabox.init()});