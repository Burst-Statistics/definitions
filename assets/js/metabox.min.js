"use strict";jQuery(document).ready(function(b){function a(){this.post_count=rspdef.post_count;this.existing_definitions=rspdef.existing_definitions;this.animation_time=-40;this.animation_time_begin=-20;this.animation_time_end=20;this.definition_count_current=0;this.definition_count_new=0;this.step=0;this.performance_level=0;this.typingTimer;this.doneTypingInterval=800;this.last_checked_definition;this.ajaxCallActive=false;this.init=function(){if(b(".block-editor__container").length){window.tagBox&&window.tagBox.init()}this.add_performance_notice();this.performance_notice_ajax();this.set_enable_checkbox_state();this.set_add_tag_state();this.conditionally_show_use_image();b(document).on("keyup",'#definitions_box_id input[name="newtag[definitions_title]"]',function(d){clearTimeout(this.typingTimer);this.typingTimer=setTimeout(this.afterFinishedTyping,this.doneTypingInterval)});b(document).on("keydown",'#definitions_box_id input[name="newtag[definitions_title]"]',function(d){clearTimeout(this.typingTimer)});b(document).on("click",'#definitions_box_id input[name="rspdef-definition-add"]',this.handle_add_tag);b(document).on("click",".remove-tag-icon",this.handle_remove_tag);b(document).on("change",'#definitions_box_id select[name="rspdef-link-type"]',this.conditionally_show_use_image)};this.handle_remove_tag=function(){this.set_add_tag_state();this.remove_definition_from_all_list(b(this));this.set_add_definition_state();this.performance_notice_ajax();this.set_enable_checkbox_state()};this.handle_add_tag=function(){this.add_definition_to_all_list();this.performance_notice_ajax();this.set_add_tag_state();this.set_add_definition_state();this.set_enable_checkbox_state()};this.afterFinishedTyping=function(d){this.performance_notice_ajax();this.set_add_tag_state();this.set_add_definition_state();this.set_enable_checkbox_state()};this.set_add_definition_state=function(){var h=b('#definitions_box_id input[name="newtag[definitions_title]"]').val();if(h.length==0){return}var e=h.split(",");var g=this.get_existing_definitions_from_list(e);if(g.length>0){if(g.length>1){g=g.join(", ");var f=this.localize_string("already-in-use-plural").replace("{definitions}",g)}else{var f=this.localize_string("already-in-use-single").replace("{definitions}",g)}var d='<div class="rspdef-icon-bullet rspdef-icon-bullet-red"></div><span class="rspdef-comment">'+f+"</span>";b("#definitions_box_id .rspdef-definition-add-notice").html(d);b('#definitions_box_id input[name="rspdef-definition-add"]').prop("disabled",true)}else{if(h.indexOf(",")>=0){var f=this.localize_string("not-in-use-plural").replace("{definitions}",h)}else{var f=this.localize_string("not-in-use-single").replace("{definitions}",h)}var d='<div class="rspdef-icon-bullet rspdef-icon-bullet-green"></div><span class="rspdef-comment">'+f+"</span>";b("#definitions_box_id .rspdef-definition-add-notice").html(d);b('#definitions_box_id input[name="rspdef-definition-add"]').prop("disabled",false)}};this.get_existing_definitions_from_list=function(d){var f=[];for(let i=0;i<d.length;i++){var e=b.trim(d[i]);if(b.inArray(e,this.existing_definitions)!==-1){f.push(e)}}return f};this.set_enable_checkbox_state=function(){var d=this.get_post_definitions_list(false);if(d.length>0){b("#definitions_box_id .rspdef-show-if-term ").removeClass("rspdef-disabled");b("#definitions_box_id input.rspdef-link-type").prop("disabled",false)}else{b("#definitions_box_id .rspdef-show-if-term ").addClass("rspdef-disabled");b("#definitions_box_id input.rspdef-link-type").prop("disabled",true)}};this.set_add_tag_state=function(){var d=this.get_post_definitions_list(true);if(d.length>0){b("#definitions_box_id .rspdef-definition-add-notice").hide();b('#definitions_box_id input[name="rspdef-definition-add"]').closest(".ajaxtag").hide()}else{var e='<div class="rspdef-icon-bullet rspdef-icon-bullet-red"></div><span class="rspdef-comment">'+this.localize_string("add-term")+"</span>";b("#definitions_box_id .rspdef-definition-add-notice").html(e).show();b('#definitions_box_id input[name="rspdef-definition-add"]').closest(".ajaxtag").show()}};this.get_post_definitions_list=function(e){e=(typeof(e)!=="undefined")?e:false;var g=[];if(!e){var f=b('#definitions_box_id input[name="newtag[definitions_title]"]').val();if(f.length){f=f.split(",");for(var d in f){if(f.hasOwnProperty(d)){g.push(f[d])}}}}b("#definitions_box_id .rspdef-post-definition-list li").each(function(){g.push(b(this).html().split("&nbsp;").pop())});return g};this.localize_string=function(d){if(rspdef.strings.hasOwnProperty(d)){return rspdef.strings[d]}return""};this.add_definition_to_all_list=function(){var d=this.get_post_definitions_list().pop();this.existing_definitions.push(d)};this.remove_definition_from_all_list=function(e){var d=e.next().html().split(" ").pop();this.existing_definitions=this.existing_definitions.filter(function(f){return f!=d})};this.performance_notice_ajax=function(){var d=this.get_post_definitions_list();if(d.length==0){return}if(this.last_checked_definition===d[0]){return}if(this.ajaxCallActive){return}b(".rspdef-performance-notice").html(this.localize_string("retrieving-status"));this.performance_level=-1;this.ajaxCallActive=true;b.ajax({type:"GET",url:rspdef.url,dataType:"json",data:({action:"rspdef_scan_definition_count",definitions:d,post_id:b("#post_ID").val()}),success:function(e){this.last_checked_definition=d[0];this.ajaxCallActive=false;if(e.success){this.definition_count_new=e.count;this.start_animation()}},error:function(e){console.log("error retrieving count");this.ajaxCallActive=false}})};this.start_animation=function(){if(this.definition_count_current==this.definition_count_new){this.animation_time=this.animation_time_end}else{this.animation_time=this.animation_time_begin;this.step=(this.definition_count_new-this.definition_count_current)/40}this.animate_performance_notice()};this.anitation_time_to_wait=function(d){return 0.1*d*d+d+1};this.animate_performance_notice=function(){var d=this.calculate_performance_level(Math.round(this.definition_count_current),this.post_count);if(this.animation_time!=this.animation_time_end){this.animation_time++;this.definition_count_current=Number(this.definition_count_current)+Number(this.step);if(this.performance_level!=d){this.performance_level=d;this.add_performance_notice();setTimeout(this.animate_performance_notice,this.anitation_time_to_wait(this.animation_time))}else{b("#definitions_box_id .rspdef-definition-count").html(Math.round(this.definition_count_current));setTimeout(this.animate_performance_notice,this.anitation_time_to_wait(this.animation_time))}}else{if(this.performance_level!=d){this.performance_level=d;this.definition_count_current=this.definition_count_new;this.add_performance_notice()}else{b("#definitions_box_id .rspdef-definition-count").val(this.definition_count_new);this.definition_count_current=this.definition_count_new}}};this.add_performance_notice=function(){var e=this.get_post_definitions_list();if(e.length>0){b("#definitions_box_id .rspdef-show-if-term ").removeClass("rspdef-disabled")}else{b("#definitions_box_id .rspdef-show-if-term ").addClass("rspdef-disabled")}var d=this.get_performance_notice_html(this.definition_count_current);b("#definitions_box_id .rspdef-performance-notice").html(d)};this.get_performance_notice_html=function(d){d=Math.round(d);var g="";var h="<span class='rspdef-definition-count-notice'>"+this.localize_string("terms-in-posts")+"<span>";h=h.replace("{terms_count}","<span class='rspdef-definition-count'>"+d+"</span>");h=h.replace("{posts_count}",""+this.post_count);var f="";if(this.performance_level==4){g="<div class='rspdef-icon-bullet rspdef-icon-bullet-red'></div>";f="<span class='rspdef-comment'>"+this.localize_string("way-too-many-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+this.localize_string("read-more")+"</a><span>"}if(this.performance_level==3){g="<div class='rspdef-icon-bullet rspdef-icon-bullet-orange'></div>";f="<span class='rspdef-comment'>"+this.localize_string("too-many-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+this.localize_string("read-more")+"</a><span>"}if(this.performance_level==2){g="<div class='rspdef-icon-bullet rspdef-icon-bullet-orange'></div>";f="<span class='rspdef-comment'>"+this.localize_string("few-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+this.localize_string("read-more")+"</a><span>"}if(this.performance_level==1){g="<div class='rspdef-icon-bullet rspdef-icon-bullet-green'></div>";f="<span class='rspdef-comment'>"+this.localize_string("positive-ratio-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+this.localize_string("read-more")+"</a><span>"}if(this.performance_level==0){g="<div class='rspdef-icon-bullet rspdef-icon-bullet-red'></div>";f="<span class='rspdef-comment'>"+this.localize_string("no-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+this.localize_string("read-more")+"</a><span>"}var e="";e+="<div class='rspdef-field'>";e+=g;e+=h;e+="</div>";e+=f;e+="<input type='hidden' class='rspdef-definition-ids' value='"+d+"'>";e+="<br><br>";return e};this.calculate_performance_level=function(d,e){if((d==0)){return 0}if((d<5)){return 2}if((d>500)&&(d/e>0.5)){return 4}if((d>100)&&(d/e>0.25)){return 3}return 1};this.conditionally_show_use_image=function(){if(b('#definitions_box_id select[name="rspdef-link-type"]').val()!=="hyperlink"){b(".rspdef-disable-image").closest(".rspdef-field").show()}else{b(".rspdef-disable-image").closest(".rspdef-field").hide()}}}var c=new a();c.init()});