"use strict";(function(a){window.wpdef_metabox={init:function(){if(a(".block-editor__container").length){window.tagBox&&window.tagBox.init()}wpdef_metabox.post_count=wpdef.post_count;wpdef_metabox.existing_definitions=wpdef.existing_definitions;wpdef_metabox.animation_time=-40;wpdef_metabox.animation_time_begin=-20;wpdef_metabox.animation_time_end=20;wpdef_metabox.definition_count_current=0;wpdef_metabox.definition_count_new=0;wpdef_metabox.step=0;wpdef_metabox.performance_level=1;wpdef_metabox.add_performance_notice();wpdef_metabox.performance_notice_ajax();wpdef_metabox.set_enable_checkbox_state();wpdef_metabox.conditionally_show_use_image();a(document).on("click",'input[name="dfn-definition-add"]',wpdef_metabox.performance_notice_ajax);a(document).on("click",'span[class="remove-tag-icon"]',wpdef_metabox.performance_notice_ajax);a(document).on("click",'input[name="dfn-definition-add"]',wpdef_metabox.add_definition_to_all_list);a(document).on("click",'span[class="remove-tag-icon"]',wpdef_metabox.remove_definition_from_all_list);a(document).on("click",'input[name="dfn-definition-add"]',wpdef_metabox.set_add_definition_state);a(document).on("click",'span[class="remove-tag-icon"]',wpdef_metabox.set_add_definition_state);a(document).on("keyup",'input[name="newtag[definitions_title]"]',wpdef_metabox.set_add_definition_state);a(document).on("change",'input[type="checkbox"][name="dfn-use-tooltip"]',wpdef_metabox.conditionally_show_use_image)},set_add_definition_state:function(){var f=a('input[name="newtag[definitions_title]"]').val();if(f.length==0){var b='<div class="dfn-icon-bullet-invisible"></div><span class="dfn-comment">'+wpdef_metabox.localize_string("add-term")+"</span>";a(".dfn-definition-add-notice").html(b);return}var c=f.split(",");var e=wpdef_metabox.get_existing_definitions_from_list(c);if(e.length>0){if(e.length>1){e=e.join(", ");var d=wpdef_metabox.localize_string("already-in-use-plural").replace("{definitions}",e)}else{var d=wpdef_metabox.localize_string("already-in-use-single").replace("{definitions}",e)}var b='<div class="dfn-icon-bullet-red"></div><span class="dfn-comment">'+d+"</span>";a(".dfn-definition-add-notice").html(b);a('input[name="dfn-definition-add"]').prop("disabled",true)}else{if(f.indexOf(",")>=0){var d=wpdef_metabox.localize_string("not-in-use-plural").replace("{definitions}",f)}else{var d=wpdef_metabox.localize_string("not-in-use-single").replace("{definitions}",f)}var b='<div class="dfn-icon-bullet-green"></div><span class="dfn-comment">'+d+"</span>";a(".dfn-definition-add-notice").html(b);a('input[name="dfn-definition-add"]').prop("disabled",false)}},get_existing_definitions_from_list:function(b){var d=[];for(let i=0;i<b.length;i++){var c=a.trim(b[i]);if(a.inArray(c,wpdef_metabox.existing_definitions)!==-1){d.push(c)}}return d},set_enable_checkbox_state:function(){if(wpdef_metabox.get_post_definitions_list().length==0){a('input[class="dfn-enable"]').prop("disabled",true);a('input[class="dfn-enable"]').prop("checked",false)}else{a('input[class="dfn-enable"]').prop("disabled",false)}},get_post_definitions_list:function(){var b=[];a(".dfn-post-definition-list li").each(function(){b.push(a(this).html().split("&nbsp;").pop())});return b},localize_string:function(b){if(wpdef.strings.hasOwnProperty(b)){return wpdef.strings[b]}return""},add_definition_to_all_list:function(){var b=wpdef_metabox.get_post_definitions_list().pop();wpdef_metabox.existing_definitions.push(b);wpdef_metabox.set_enable_checkbox_state()},remove_definition_from_all_list:function(){var b=a(this).next().html().split(" ").pop();wpdef_metabox.existing_definitions=wpdef_metabox.existing_definitions.filter(function(c){return c!=b});wpdef_metabox.set_enable_checkbox_state()},performance_notice_ajax:function(){var b=wpdef_metabox.get_post_definitions_list();a.ajax({type:"GET",url:wpdef.url,dataType:"json",data:({action:"wpdef_scan_definition_count",definitions:b,post_id:a("#post_ID").val()}),success:function(c){if(c.success){wpdef_metabox.definition_count_new=c.count;wpdef_metabox.start_animation()}}})},start_animation:function(){if(wpdef_metabox.definition_count_current==wpdef_metabox.definition_count_new){return}wpdef_metabox.animation_time=wpdef_metabox.animation_time_begin;wpdef_metabox.step=(wpdef_metabox.definition_count_new-wpdef_metabox.definition_count_current)/40;wpdef_metabox.animate_performance_notice()},anitation_time_to_wait:function(b){return 0.1*b*b+b+1},animate_performance_notice:function(){var b=wpdef_metabox.calculate_performance_level(Math.round(wpdef_metabox.definition_count_current),wpdef_metabox.post_count);if(wpdef_metabox.animation_time!=wpdef_metabox.animation_time_end){wpdef_metabox.animation_time++;wpdef_metabox.definition_count_current+=wpdef_metabox.step;if(wpdef_metabox.performance_level!=b){wpdef_metabox.performance_level=b;wpdef_metabox.add_performance_notice();setTimeout(wpdef_metabox.animate_performance_notice,wpdef_metabox.anitation_time_to_wait(wpdef_metabox.animation_time))}else{a(".dfn-definition-count").html(Math.round(wpdef_metabox.definition_count_current));setTimeout(wpdef_metabox.animate_performance_notice,wpdef_metabox.anitation_time_to_wait(wpdef_metabox.animation_time))}}else{if(wpdef_metabox.performance_level!=wpdef_metabox.calculate_performance_level(Math.round(wpdef_metabox.definition_count_current),wpdef_metabox.post_count)){wpdef_metabox.performance_level=b;wpdef_metabox.definition_count_current=wpdef_metabox.definition_count_new;wpdef_metabox.add_performance_notice()}else{a(".dfn-definition-count").val(wpdef_metabox.definition_count_new);wpdef_metabox.definition_count_current=wpdef_metabox.definition_count_new}}},add_performance_notice:function(){var b=wpdef_metabox.get_performance_notice_html(wpdef_metabox.definition_count_current);a(".dfn-performance-notice").html(b)},get_performance_notice_html:function(b){b=Math.round(b);var e="";var f="<span class='dfn-definition-count-notice'>"+wpdef_metabox.localize_string("terms-in-posts")+"<span>";f=f.replace("{terms_count}","<span class='dfn-definition-count'>"+b+"</span>");f=f.replace("{posts_count}",""+wpdef_metabox.post_count);var d="";if(wpdef_metabox.performance_level==3){e="<div class='dfn-icon-bullet-red'></div>";d="<span class='dfn-comment'>"+wpdef_metabox.localize_string("way-too-many-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>"}if(wpdef_metabox.performance_level==2){e="<div class='dfn-icon-bullet-orange'></div>";d="<span class='dfn-comment'>"+wpdef_metabox.localize_string("too-many-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>"}if(wpdef_metabox.performance_level==1){e="<div class='dfn-icon-bullet-green'></div>";d="<span class='dfn-comment'>"+wpdef_metabox.localize_string("positive-ratio-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>"}var c="";c+="<div class='dfn-field'>";c+=e;c+=f;c+="</div>";c+=d;c+="<input type='hidden' class='dfn-definition-ids' value='"+b+"'>";c+="<br><br>";return c},calculate_performance_level:function(b,c){if(b/c>0.5){return 3}if(b/c>0.25){return 2}return 1},conditionally_show_use_image:function(){if(a('input[type="checkbox"][name="dfn-use-tooltip"]')[0].checked){a(".dfn-disable-image").closest(".dfn-field").show()}else{a(".dfn-disable-image").closest(".dfn-field").hide()}}}}(jQuery));jQuery(document).ready(function(a){window.wpdef_metabox.init()});