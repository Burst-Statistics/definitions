"use strict";!function(e){window.wpdef_metabox={init:function(){e(".block-editor__container").length&&window.tagBox&&window.tagBox.init(),wpdef_metabox.post_count=wpdef.post_count,wpdef_metabox.existing_definitions=wpdef.existing_definitions,wpdef_metabox.animation_time=-40,wpdef_metabox.animation_time_begin=-20,wpdef_metabox.animation_time_end=20,wpdef_metabox.definition_count_current=0,wpdef_metabox.definition_count_new=0,wpdef_metabox.step=0,wpdef_metabox.performance_level=1,wpdef_metabox.add_performance_notice(),wpdef_metabox.performance_notice_ajax(),wpdef_metabox.set_enable_checkbox_state(),wpdef_metabox.set_add_tag_state(),wpdef_metabox.conditionally_show_use_image(),e(document).on("click",'input[name="dfn-definition-add"]',wpdef_metabox.performance_notice_ajax),e(document).on("click",'span[class="remove-tag-icon"]',wpdef_metabox.performance_notice_ajax),e(document).on("click",'input[name="dfn-definition-add"]',wpdef_metabox.add_definition_to_all_list),e(document).on("click",'span[class="remove-tag-icon"]',wpdef_metabox.remove_definition_from_all_list),e(document).on("click",'input[name="dfn-definition-add"]',wpdef_metabox.set_add_definition_state),e(document).on("click",'span[class="remove-tag-icon"]',wpdef_metabox.set_add_definition_state),e(document).on("keyup",'input[name="newtag[definitions_title]"]',wpdef_metabox.set_add_definition_state),e(document).on("change",'input[type="checkbox"][name="dfn-use-tooltip"]',wpdef_metabox.conditionally_show_use_image)},set_add_definition_state:function(){wpdef_metabox.set_add_tag_state();var t=e('input[name="newtag[definitions_title]"]').val();if(0!=t.length){var n=t.split(","),i=wpdef_metabox.get_existing_definitions_from_list(n);if(i.length>0){if(i.length>1){i=i.join(", ");var o=wpdef_metabox.localize_string("already-in-use-plural").replace("{definitions}",i)}else o=wpdef_metabox.localize_string("already-in-use-single").replace("{definitions}",i);var a='<div class="dfn-icon-bullet-red"></div><span class="dfn-comment">'+o+"</span>";e(".dfn-definition-add-notice").html(a),e('input[name="dfn-definition-add"]').prop("disabled",!0)}else{if(t.indexOf(",")>=0)o=wpdef_metabox.localize_string("not-in-use-plural").replace("{definitions}",t);else o=wpdef_metabox.localize_string("not-in-use-single").replace("{definitions}",t);a='<div class="dfn-icon-bullet-green"></div><span class="dfn-comment">'+o+"</span>";e(".dfn-definition-add-notice").html(a),e('input[name="dfn-definition-add"]').prop("disabled",!1)}}},get_existing_definitions_from_list:function(t){var n=[];for(let o=0;o<t.length;o++){var i=e.trim(t[o]);-1!==e.inArray(i,wpdef_metabox.existing_definitions)&&n.push(i)}return n},set_enable_checkbox_state:function(){0==wpdef_metabox.get_post_definitions_list().length?(e('input[class="dfn-enable"]').prop("disabled",!0),e('input[class="dfn-enable"]').prop("checked",!1)):e('input[class="dfn-enable"]').prop("disabled",!1)},set_add_tag_state:function(){if(wpdef_metabox.get_post_definitions_list().length>0)e(".dfn-definition-add-notice").hide(),e('input[name="dfn-definition-add"]').closest(".ajaxtag").hide();else{var t='<div class="dfn-icon-bullet-invisible"></div><span class="dfn-comment">'+wpdef_metabox.localize_string("add-term")+"</span>";e(".dfn-definition-add-notice").html(t).show(),e('input[name="dfn-definition-add"]').closest(".ajaxtag").show()}},get_post_definitions_list:function(){var t=[];return e(".dfn-post-definition-list li").each(function(){t.push(e(this).html().split("&nbsp;").pop())}),t},localize_string:function(e){return wpdef.strings.hasOwnProperty(e)?wpdef.strings[e]:""},add_definition_to_all_list:function(){var e=wpdef_metabox.get_post_definitions_list().pop();wpdef_metabox.existing_definitions.push(e),wpdef_metabox.set_enable_checkbox_state()},remove_definition_from_all_list:function(){var t=e(this).next().html().split(" ").pop();wpdef_metabox.existing_definitions=wpdef_metabox.existing_definitions.filter(function(e){return e!=t}),wpdef_metabox.set_enable_checkbox_state()},performance_notice_ajax:function(){var t=wpdef_metabox.get_post_definitions_list();e.ajax({type:"GET",url:wpdef.url,dataType:"json",data:{action:"wpdef_scan_definition_count",definitions:t,post_id:e("#post_ID").val()},success:function(e){e.success&&(wpdef_metabox.definition_count_new=e.count,wpdef_metabox.start_animation())}})},start_animation:function(){wpdef_metabox.definition_count_current!=wpdef_metabox.definition_count_new&&(wpdef_metabox.animation_time=wpdef_metabox.animation_time_begin,wpdef_metabox.step=(wpdef_metabox.definition_count_new-wpdef_metabox.definition_count_current)/40,wpdef_metabox.animate_performance_notice())},anitation_time_to_wait:function(e){return.1*e*e+e+1},animate_performance_notice:function(){var t=wpdef_metabox.calculate_performance_level(Math.round(wpdef_metabox.definition_count_current),wpdef_metabox.post_count);wpdef_metabox.animation_time!=wpdef_metabox.animation_time_end?(wpdef_metabox.animation_time++,wpdef_metabox.definition_count_current=Number(wpdef_metabox.definition_count_current)+Number(wpdef_metabox.step),wpdef_metabox.performance_level!=t?(wpdef_metabox.performance_level=t,wpdef_metabox.add_performance_notice(),setTimeout(wpdef_metabox.animate_performance_notice,wpdef_metabox.anitation_time_to_wait(wpdef_metabox.animation_time))):(e(".dfn-definition-count").html(Math.round(wpdef_metabox.definition_count_current)),setTimeout(wpdef_metabox.animate_performance_notice,wpdef_metabox.anitation_time_to_wait(wpdef_metabox.animation_time)))):wpdef_metabox.performance_level!=wpdef_metabox.calculate_performance_level(Math.round(wpdef_metabox.definition_count_current),wpdef_metabox.post_count)?(wpdef_metabox.performance_level=t,wpdef_metabox.definition_count_current=wpdef_metabox.definition_count_new,wpdef_metabox.add_performance_notice()):(e(".dfn-definition-count").val(wpdef_metabox.definition_count_new),wpdef_metabox.definition_count_current=wpdef_metabox.definition_count_new)},add_performance_notice:function(){var t=wpdef_metabox.get_performance_notice_html(wpdef_metabox.definition_count_current);e(".dfn-performance-notice").html(t)},get_performance_notice_html:function(e){e=Math.round(e);var t="",n="<span class='dfn-definition-count-notice'>"+wpdef_metabox.localize_string("terms-in-posts")+"<span>";n=(n=n.replace("{terms_count}","<span class='dfn-definition-count'>"+e+"</span>")).replace("{posts_count}",""+wpdef_metabox.post_count);var i="";3==wpdef_metabox.performance_level&&(t="<div class='dfn-icon-bullet-red'></div>",i="<span class='dfn-comment'>"+wpdef_metabox.localize_string("way-too-many-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>"),2==wpdef_metabox.performance_level&&(t="<div class='dfn-icon-bullet-orange'></div>",i="<span class='dfn-comment'>"+wpdef_metabox.localize_string("too-many-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>"),1==wpdef_metabox.performance_level&&(t="<div class='dfn-icon-bullet-green'></div>",i="<span class='dfn-comment'>"+wpdef_metabox.localize_string("positive-ratio-terms")+" <a href='https://really-simple-plugins.com/internal-linkbuilder/'>"+wpdef_metabox.localize_string("read-more")+"</a><span>");var o="";return o+="<div class='dfn-field'>",o+=t,o+=n,o+="</div>",o+=i,o+="<input type='hidden' class='dfn-definition-ids' value='"+e+"'>",o+="<br><br>"},calculate_performance_level:function(e,t){return e/t>.5?3:e/t>.25?2:1},conditionally_show_use_image:function(){e('input[type="checkbox"][name="dfn-use-tooltip"]')[0].checked?e(".dfn-disable-image").closest(".dfn-field").show():e(".dfn-disable-image").closest(".dfn-field").hide()}}}(jQuery),jQuery(document).ready(function(e){window.wpdef_metabox.init()});